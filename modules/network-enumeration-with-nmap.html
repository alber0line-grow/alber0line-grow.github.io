<body>
  <div class="container">
    <link rel="stylesheet" href="style.css">

    <h1 id="1-network-enumeration-with-nmap">1. Exploration du réseau avec Nmap</h1>
    <h2 id="-cheat-sheet-"><strong>Aide-mémoire</strong></h2>
    <p>Cette feuille de rappel est une référence utile des commandes pour ce module.</p>
    <h3 id="scanning-options">Options de balayage</h3>
    <table>
      <thead>
        <tr>
          <th><strong>Option Nmap</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.10.10.0/24</code></td>
          <td>Plage réseau cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>-PE</code></td>
          <td>Effectue un ping scan en utilisant des requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison d'un résultat spécifique.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive les requêtes ARP Ping.</td>
        </tr>
        <tr>
          <td><code>--top-ports=&lt;num&gt;</code></td>
          <td>Scanne le nombre spécifié de ports les plus fréquents.</td>
        </tr>
        <tr>
          <td><code>-p-</code></td>
          <td>Scanne tous les ports.</td>
        </tr>
        <tr>
          <td><code>-p22-110</code></td>
          <td>Scanne tous les ports entre 22 et 110.</td>
        </tr>
        <tr>
          <td><code>-p22,25</code></td>
          <td>Scanne uniquement les ports spécifiés 22 et 25.</td>
        </tr>
        <tr>
          <td><code>-F</code></td>
          <td>Scanne les 100 ports les plus courants.</td>
        </tr>
        <tr>
          <td><code>-sS</code></td>
          <td>Effectue un scan TCP SYN.</td>
        </tr>
        <tr>
          <td><code>-sA</code></td>
          <td>Effectue un scan TCP ACK.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
        <tr>
          <td><code>-sV</code></td>
          <td>Scanne les services découverts pour détecter leurs versions.</td>
        </tr>
        <tr>
          <td><code>-sC</code></td>
          <td>Effectue un scan avec scripts par défaut.</td>
        </tr>
        <tr>
          <td><code>--script &lt;script&gt;</code></td>
          <td>Effectue un scan avec les scripts spécifiés.</td>
        </tr>
        <tr>
          <td><code>-O</code></td>
          <td>Effectue une détection du système d'exploitation.</td>
        </tr>
        <tr>
          <td><code>-A</code></td>
          <td>Effectue la détection d'OS, des services et un traceroute.</td>
        </tr>
        <tr>
          <td><code>-D RND:5</code></td>
          <td>Utilise un nombre de leurres aléatoires pour le scan.</td>
        </tr>
        <tr>
          <td><code>-e</code></td>
          <td>Spécifie l'interface réseau à utiliser pour le scan.</td>
        </tr>
        <tr>
          <td><code>-S 10.10.10.200</code></td>
          <td>Spécifie l'adresse IP source pour le scan.</td>
        </tr>
        <tr>
          <td><code>-g</code></td>
          <td>Spécifie le port source pour le scan.</td>
        </tr>
        <tr>
          <td><code>--dns-server &lt;ns&gt;</code></td>
          <td>Utilise un serveur DNS spécifique pour la résolution.</td>
        </tr>
      </tbody>
    </table>
    <h3 id="output-options">Options de sortie</h3>
    <table>
      <thead>
        <tr>
          <th><strong>Option Nmap</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>-oA filename</code></td>
          <td>Sauvegarde les résultats dans tous les formats disponibles.</td>
        </tr>
        <tr>
          <td><code>-oN filename</code></td>
          <td>Sauvegarde les résultats en format normal.</td>
        </tr>
        <tr>
          <td><code>-oG filename</code></td>
          <td>Sauvegarde les résultats en format "grepable".</td>
        </tr>
        <tr>
          <td><code>-oX filename</code></td>
          <td>Sauvegarde les résultats en format XML.</td>
        </tr>
      </tbody>
    </table>
    <h3 id="performance-options">Options de performance</h3>
    <table>
      <thead>
        <tr>
          <th><strong>Option Nmap</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>--max-retries &lt;num&gt;</code></td>
          <td>Définit le nombre de tentatives pour les scans de ports.</td>
        </tr>
        <tr>
          <td><code>--stats-every=5s</code></td>
          <td>Affiche l'état du scan toutes les 5 secondes.</td>
        </tr>
        <tr>
          <td><code>-v/-vv</code></td>
          <td>Active une sortie plus détaillée pendant le scan.</td>
        </tr>
        <tr>
          <td><code>--initial-rtt-timeout 50ms</code></td>
          <td>Définit la valeur initiale du timeout RTT.</td>
        </tr>
        <tr>
          <td><code>--max-rtt-timeout 100ms</code></td>
          <td>Définit la valeur maximale du timeout RTT.</td>
        </tr>
        <tr>
          <td><code>--min-rate 300</code></td>
          <td>Définit le nombre de paquets envoyés simultanément.</td>
        </tr>
        <tr>
          <td><code>-T &lt;0-5&gt;</code></td>
          <td>Spécifie un modèle de temporisation spécifique.</td>
        </tr>
      </tbody>
    </table>
    <h2 id="enumeration">Énumération</h2>
    <hr>
    <p><code>L'énumération</code> est la partie la plus critique. L'art, la difficulté et l'objectif ne sont pas d'obtenir un accès à l'ordinateur cible, mais plutôt d'identifier toutes les façons dont nous pourrions l'attaquer.</p>
    <p>Ce n'est pas seulement basé sur les outils que nous utilisons. Ils ne seront d'aucune utilité si nous ne savons pas quoi faire des informations que nous en tirons. Les outils ne sont que des outils, et ils ne devraient jamais remplacer nos connaissances et notre attention aux détails. Il s'agit ici d'interagir activement avec les différents services pour voir quelles informations ils nous fournissent et quelles possibilités ils nous offrent.</p>
    <p>Il est essentiel de comprendre comment ces services fonctionnent et quelle syntaxe ils utilisent pour une communication et une interaction efficaces avec les différents services.</p>
    <p>Le but de cette phase est d'améliorer nos connaissances et notre compréhension des technologies, des protocoles, de leur fonctionnement, et d'apprendre à traiter de nouvelles informations en les adaptant à nos connaissances acquises. L'énumération consiste à collecter le plus d'informations possible. Plus nous avons d'informations, plus il nous sera facile de trouver des vecteurs d'attaque.</p>
    <p>Imaginez la situation suivante :</p>
    <p>Votre partenaire n'est pas à la maison et a égaré vos clés de voiture. Vous appelez votre partenaire et demandez où sont les clés. Si vous obtenez une réponse comme "dans le salon", c'est totalement vague et cela peut prendre beaucoup de temps pour les trouver. Cependant, que se passe-t-il si votre partenaire vous dit quelque chose comme "dans le salon sur l'étagère blanche, à côté de la télévision, dans le troisième tiroir" ? Dans ce cas, il sera beaucoup plus facile de les trouver.</p>
    <p>Ce n'est pas difficile d'obtenir l'accès au système cible une fois que nous savons comment le faire. La plupart des moyens d'accès peuvent être réduits aux deux points suivants :</p>
    <p>Lors du balayage et de l'inspection, nous recherchons précisément ces deux possibilités. La plupart des informations que nous obtenons proviennent de mauvaises configurations ou de négligences de sécurité pour les services respectifs. Les mauvaises configurations sont soit le résultat d'une ignorance, soit d'une mauvaise mentalité en matière de sécurité. Par exemple, si l'administrateur ne compte que sur le pare-feu, les GPO et les mises à jour continues, cela ne suffit souvent pas à sécuriser le réseau.</p>
    <p><code>L'énumération est la clé</code>.</p>
    <p>C'est ce que la plupart des gens disent, et ils ont raison. Cependant, cela est souvent mal compris. La plupart des gens pensent qu'ils n'ont pas essayé tous les outils pour obtenir les informations dont ils ont besoin. Mais la plupart du temps, ce ne sont pas les outils que nous n'avons pas essayés, mais plutôt le fait que nous ne savons pas comment interagir avec le service et ce qui est pertinent.</p>
    <p>C'est précisément la raison pour laquelle tant de personnes restent bloquées et n'avancent pas. Si ces personnes avaient consacré quelques heures à en apprendre davantage sur le service, son fonctionnement et son utilité, elles auraient économisé quelques heures, voire quelques jours, pour atteindre leur objectif et obtenir l'accès au système.</p>
    <p><code>L'énumération manuelle</code> est une composante <code>critique</code>. De nombreux outils de balayage simplifient et accélèrent le processus. Cependant, ceux-ci ne peuvent pas toujours contourner les mesures de sécurité des services. Le moyen le plus simple d'illustrer cela est d'utiliser l'exemple suivant :</p>
    <p>La plupart des outils de balayage ont un timeout défini jusqu'à ce qu'ils reçoivent une réponse du service. Si cet outil ne répond pas dans un délai spécifique, ce service/port sera marqué comme fermé, filtré ou inconnu. Dans les deux derniers cas, nous pourrons encore travailler avec. Cependant, si un port est marqué comme fermé et que Nmap ne nous le montre pas, nous serons dans une mauvaise situation. Ce service/port peut nous offrir la possibilité de trouver un moyen d'accéder au système. Par conséquent, ce résultat peut nous faire perdre beaucoup de temps inutilement jusqu'à ce que nous le trouvions.</p>
    <h2 id="introduction-to-nmap">Introduction à Nmap</h2>
    <hr>
    <p>Network Mapper (<code>Nmap</code>) est un outil open source d'analyse de réseau et d'audit de sécurité écrit en C, C++, Python et Lua. Il est conçu pour scanner les réseaux et identifier quels hôtes sont disponibles sur le réseau en utilisant des paquets bruts, ainsi que les services et applications, y compris le nom et la version, si possible. Il peut également identifier les systèmes d'exploitation et les versions de ces hôtes. Outre d'autres fonctionnalités, Nmap offre également des capacités de balayage qui peuvent déterminer si les filtres de paquets, pare-feu ou systèmes de détection d'intrusion (IDS) sont configurés comme prévu.</p>
    <hr>
    <h3 id="use-cases">Cas d'utilisation</h3>
    <p>L'outil est l'un des plus utilisés par les administrateurs réseau et les spécialistes de la sécurité informatique. Il est utilisé pour :</p>
    <ul>
      <li>Auditer les aspects de sécurité des réseaux</li>
      <li>Simuler des tests de pénétration</li>
      <li>Vérifier les paramètres et configurations des pare-feu et IDS</li>
      <li>Types de connexions possibles</li>
      <li>Cartographie réseau</li>
      <li>Analyse des réponses</li>
      <li>Identifier les ports ouverts</li>
      <li>Évaluation des vulnérabilités</li>
    </ul>
    <hr>
    <h3 id="nmap-architecture">Architecture de Nmap</h3>
    <p>Nmap offre de nombreux types de scans différents qui peuvent être utilisés pour obtenir divers résultats sur nos cibles. Fondamentalement, Nmap peut être divisé en techniques de balayage suivantes :</p>
    <ul>
      <li>Découverte d'hôtes</li>
      <li>Balayage de ports</li>
      <li>Énumération et détection de services</li>
      <li>Détection d'OS</li>
      <li>Interaction scriptable avec le service cible (Nmap Scripting Engine)</li>
    </ul>
    <hr>
    <h3 id="syntax">Syntaxe</h3>
    <p>La syntaxe de Nmap est assez simple et ressemble à ceci :</p>
    <p>Introduction à Nmap</p>
    <pre><code class="lang-shell-session">root<span class="hljs-meta">@htb[/htb]$</span> nmap <span class="hljs-variable">&lt;types de scan&gt;</span> <span class="hljs-variable">&lt;options&gt;</span> <span class="hljs-variable">&lt;cible&gt;</span>
</code></pre>
    <hr>
    <h3 id="scan-techniques">Techniques de balayage</h3>
    <p>Nmap offre de nombreuses techniques de balayage différentes, établissant différents types de connexions et utilisant des paquets structurés différemment pour l'envoi. Voici toutes les techniques de balayage que Nmap propose :</p>
    <p>Introduction à Nmap</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ nmap --help

&lt;SNIP&gt;
TECHNIQUES DE BALAYAGE :
  -<span class="ruby">sS/sT/sA/sW/<span class="hljs-symbol">sM:</span> Scans TCP SYN/Connect()/ACK/Window/Maimon
</span>  -<span class="ruby"><span class="hljs-symbol">sU:</span> Scan UDP
</span>  -<span class="ruby">sN/sF/<span class="hljs-symbol">sX:</span> Scans TCP Null, FIN et Xmas
</span>  -<span class="ruby">-scanflags &lt;flags&gt;: Personnalise les drapeaux TCP
</span>  -<span class="ruby">sI &lt;zombie host[<span class="hljs-symbol">:probeport</span>]&gt;: Scan idle
</span>  -<span class="ruby">sY/<span class="hljs-symbol">sZ:</span> Scans SCTP INIT/COOKIE-ECHO
</span>  -<span class="ruby"><span class="hljs-symbol">sO:</span> Scan de protocole IP
</span>  -<span class="ruby">b &lt;FTP relay host&gt;: Scan FTP bounce
</span>&lt;SNIP&gt;
</code></pre>
    <p>Par exemple, le scan TCP-SYN (<code>-sS</code>) est l'un des paramètres par défaut, sauf si nous avons défini autre chose, et est également l'une des méthodes de scan les plus populaires. Cette méthode de scan permet de scanner plusieurs milliers de ports par seconde. Le scan TCP-SYN envoie un paquet avec le drapeau SYN et, par conséquent, ne termine jamais le handshake à trois voies, ce qui empêche l'établissement d'une connexion TCP complète vers le port scanné.</p>
    <ul>
      <li>Si notre cible renvoie un paquet avec le drapeau <code>SYN-ACK</code> au port scanné, Nmap détecte que le port est <code>ouvert</code>.</li>
      <li>Si le paquet reçoit un drapeau <code>RST</code>, c'est un indicateur que le port est <code>fermé</code>.</li>
      <li>Si Nmap ne reçoit pas de paquet en retour, il l'affichera comme <code>filtré</code>. Selon la configuration du pare-feu, certains paquets peuvent être abandonnés ou ignorés.</li>
    </ul>
    <p>Prenons un exemple d'un tel scan.</p>
    <p>Introduction à Nmap</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo <span class="hljs-keyword">nmap</span> -sS localhost

Starting Nmap <span class="hljs-number">7.80</span> ( http<span class="hljs-variable">s:</span>//<span class="hljs-keyword">nmap</span>.org ) at <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">11</span> <span class="hljs-number">22</span>:<span class="hljs-number">50</span> UTC
Nmap scan report <span class="hljs-keyword">for</span> localhost (<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>)
Host <span class="hljs-keyword">is</span> <span class="hljs-keyword">up</span> (<span class="hljs-number">0.000010</span>s latency).
Not shown: <span class="hljs-number">996</span> closed ports
PORT     STATE SERVICE
<span class="hljs-number">22</span>/tcp   <span class="hljs-keyword">open</span>  ssh
<span class="hljs-number">80</span>/tcp   <span class="hljs-keyword">open</span>  http
<span class="hljs-number">5432</span>/tcp <span class="hljs-keyword">open</span>  postgresql
<span class="hljs-number">5901</span>/tcp <span class="hljs-keyword">open</span>  vnc-<span class="hljs-number">1</span>

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host <span class="hljs-keyword">up</span>) scanned in <span class="hljs-number">0.18</span> seconds
</code></pre>
    <p>Dans cet exemple, nous pouvons voir que nous avons quatre ports TCP ouverts différents. Dans la première colonne, nous voyons le numéro du port. Ensuite, dans la deuxième colonne, nous voyons le statut du service, puis le type de service.</p>
    <h2 id="host-discovery">Découverte d'hôtes</h2>
    <hr>
    <p>Lorsque nous devons effectuer un test d'intrusion interne pour l'ensemble du réseau d'une entreprise, par exemple, nous devons d'abord obtenir un aperçu des systèmes en ligne avec lesquels nous pouvons travailler. Pour découvrir activement ces systèmes sur le réseau, nous pouvons utiliser diverses options de découverte d'hôtes de <code>Nmap</code>. Il existe de nombreuses options que <code>Nmap</code> fournit pour déterminer si notre cible est active ou non. La méthode de découverte d'hôtes la plus efficace consiste à utiliser des <strong>requêtes ICMP echo</strong>, que nous allons examiner.</p>
    <p>Il est toujours recommandé de stocker chaque scan. Cela peut ensuite être utilisé pour des comparaisons, de la documentation et des rapports. Après tout, différents outils peuvent produire des résultats différents. Par conséquent, il peut être avantageux de distinguer quel outil produit quels résultats.</p>
    <p><strong>Balayer une plage réseau</strong></p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> -sn -oA tnet | grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.4</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.11</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span>
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.0/24</code></td>
          <td>Plage réseau cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA tnet</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'tnet'.</td>
        </tr>
      </tbody>
    </table>
    <p>Cette méthode de balayage fonctionne uniquement si les pare-feu des hôtes le permettent. Sinon, nous pouvons utiliser d'autres techniques de balayage pour savoir si les hôtes sont actifs ou non. Nous examinerons de plus près ces techniques dans "<code>Contournement de pare-feu et IDS</code>".</p>
    <hr>
    <h3 id="scan-ip-list">Balayer une liste d'IP</h3>
    <p>Lors d'un test d'intrusion interne, il n'est pas rare qu'on nous fournisse une liste d'IP avec les hôtes que nous devons tester. <code>Nmap</code> nous donne également la possibilité de travailler avec des listes et de lire les hôtes de cette liste au lieu de les définir ou de les saisir manuellement.</p>
    <p>Une telle liste pourrait ressembler à ceci :</p>
    <pre><code class="lang-shell-session">[!bash!]$ cat hosts.lst

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.4</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.11</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span>
</code></pre>
    <p>Si nous utilisons la même technique de balayage sur la liste prédéfinie, la commande ressemblera à ceci :</p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA tnet</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'tnet'.</td>
        </tr>
        <tr>
          <td><code>-iL</code></td>
          <td>Effectue les scans définis contre les cibles dans la liste 'hosts.lst' fournie.</td>
        </tr>
      </tbody>
    </table>
    <p>Dans cet exemple, nous voyons que seulement 3 des 7 hôtes sont actifs. Rappelez-vous, cela peut signifier que les autres hôtes ignorent les <strong>requêtes ICMP echo</strong> par défaut à cause de leurs configurations de pare-feu. Comme <code>Nmap</code> ne reçoit pas de réponse, il marque ces hôtes comme inactifs.</p>
    <hr>
    <h3 id="scan-multiple-ips">Balayer plusieurs IP</h3>
    <p>Il peut aussi arriver que nous ayons besoin de scanner une petite partie d'un réseau. Une alternative à la méthode que nous avons utilisée la dernière fois est de spécifier plusieurs adresses IP.</p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap -sn -oA tnet <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>| grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
</code></pre>
    <p>Si ces adresses IP sont côte à côte, nous pouvons également définir la plage dans l'octet respectif.</p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap -sn -oA tnet <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span><span class="hljs-number">-20</span>| grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
</code></pre>
    <hr>
    <h3 id="scan-single-ip">Balayer une IP unique</h3>
    <p>Avant de scanner un hôte unique pour ses ports ouverts et ses services, nous devons d'abord déterminer s'il est vivant ou non. Pour cela, nous pouvons utiliser la même méthode qu'avant.</p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span> -sn -oA host 

Starting Nmap <span class="hljs-number">7.80</span> ( <span class="hljs-string">https:</span><span class="hljs-comment">//nmap.org ) at 2020-06-14 23:59 CEST</span>
Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
Host is up (<span class="hljs-number">0.087</span>s latency).
MAC <span class="hljs-string">Address:</span> <span class="hljs-string">DE:</span><span class="hljs-string">AD:</span><span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-string">BE:</span>EF
Nmap <span class="hljs-string">done:</span> <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.11</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.18</code></td>
          <td>Effectue les scans définis contre la cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA host</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'host'.</td>
        </tr>
      </tbody>
    </table>
    <p>Si nous désactivons le scan de ports (<code>-sn</code>), Nmap effectue automatiquement un ping scan avec des <code>Requêtes ICMP Echo</code> (<code>-PE</code>). Une fois qu'une telle requête est envoyée, nous nous attendons généralement à une <code>réponse ICMP</code> si l'hôte pingué est vivant. Le fait le plus intéressant est que nos scans précédents ne l'ont pas fait car avant que Nmap puisse envoyer une requête ICMP echo, il enverrait un <code>ping ARP</code> aboutissant à une <code>réponse ARP</code>. Nous pouvons le confirmer avec l'option "<code>--packet-trace</code>". Pour s'assurer que les requêtes ICMP echo sont envoyées, nous définissons également l'option (<code>-PE</code>) pour cela.</p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> -sn -oA host -PE --packet-trace 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">00</span>:<span class="hljs-number">08</span> CEST
SENT (<span class="hljs-number">0.</span>0074s) ARP who-has <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> tell <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>
RCVD (<span class="hljs-number">0.</span>0309s) ARP reply <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> is-<span class="hljs-meta">at</span> DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>023s latency).
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.05</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.18</code></td>
          <td>Effectue les scans définis contre la cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA host</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'host'.</td>
        </tr>
        <tr>
          <td><code>-PE</code></td>
          <td>Effectue le ping scan en utilisant des 'requêtes ICMP Echo' contre la cible.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Montre tous les paquets envoyés et reçus</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Une autre façon de déterminer pourquoi Nmap a marqué notre cible comme "vivante" est avec l'option "<code>--reason</code>".</p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> -sn -oA host -PE --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">00</span>:<span class="hljs-number">10</span> CEST
SENT (<span class="hljs-number">0.</span>0074s) ARP who-has <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> tell <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>
RCVD (<span class="hljs-number">0.</span>0309s) ARP reply <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> is-<span class="hljs-meta">at</span> DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span>
Host is <span class="hljs-meta">up</span>, received arp-response (<span class="hljs-number">0.</span>028s latency).
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.03</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.18</code></td>
          <td>Effectue les scans définis contre la cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA host</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'host'.</td>
        </tr>
        <tr>
          <td><code>-PE</code></td>
          <td>Effectue le ping scan en utilisant des 'requêtes ICMP Echo' contre la cible.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison d'un résultat spécifique.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous voyons ici que <code>Nmap</code> détecte en effet si l'hôte est vivant ou non uniquement par la <code>requête ARP</code> et la <code>réponse ARP</code>. Pour désactiver les requêtes ARP et scanner notre cible avec les <code>requêtes ICMP echo</code> souhaitées, nous pouvons désactiver les pings ARP en définissant l'option "<code>--disable-arp-ping</code>". Ensuite, nous pouvons scanner à nouveau notre cible et examiner les paquets envoyés et reçus.</p>
    <pre><code class="lang-shell-session">[!bash!]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> -sn -oA host -PE --packet-trace --disable-arp-ping 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">00</span>:<span class="hljs-number">12</span> CEST
SENT (<span class="hljs-number">0.</span>0107s) ICMP [<span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> Echo request (type=<span class="hljs-number">8</span>/code=<span class="hljs-number">0</span>) id=<span class="hljs-number">13607</span> seq=<span class="hljs-number">0</span>] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">255</span> id=<span class="hljs-number">23541</span> iplen=<span class="hljs-number">28</span> ]
RCVD (<span class="hljs-number">0.</span>0152s) ICMP [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span> Echo reply (type=<span class="hljs-number">0</span>/code=<span class="hljs-number">0</span>) id=<span class="hljs-number">13607</span> seq=<span class="hljs-number">0</span>] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">128</span> id=<span class="hljs-number">40622</span> iplen=<span class="hljs-number">28</span> ]
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>086s latency).
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.11</span> seconds
</code></pre>
    <p>Nous avons déjà mentionné dans le "<code>Processus d'apprentissage</code>" et au début de ce module qu'il est essentiel de prêter attention aux détails. Une <code>requête ICMP echo</code> peut nous aider à déterminer si notre cible est vivante et à identifier son système. Plus de stratégies sur la découverte d'hôtes peuvent être trouvées à :</p>
    <p>{% embed url="<a href="https://nmap.org/book/host-discovery-strategies.html">https://nmap.org/book/host-discovery-strategies.html</a>" %}</p>
    <h2 id="host-and-port-scanning">Balayage d'hôtes et de ports</h2>
    <hr>
    <p>Il est essentiel de comprendre comment l'outil que nous utilisons fonctionne et comment il exécute et traite les différentes fonctions. Nous ne comprendrons les résultats que si nous savons ce qu'ils signifient et comment ils sont obtenus. Par conséquent, nous allons examiner et analyser de plus près certaines des méthodes de balayage. Après avoir découvert que notre cible est vivante, nous voulons obtenir une image plus précise du système. Les informations dont nous avons besoin incluent :</p>
    <ul>
      <li>Ports ouverts et leurs services</li>
      <li>Versions des services</li>
      <li>Informations fournies par les services</li>
      <li>Système d'exploitation</li>
    </ul>
    <p>Il y a un total de 6 états différents pour un port scanné que nous pouvons obtenir :</p>
    <table>
      <thead>
        <tr>
          <th><strong>État</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>ouvert</code></td>
          <td>Ceci indique que la connexion au port scanné a été établie. Ces connexions peuvent être des <strong>connexions TCP</strong>, des <strong>datagrammes UDP</strong> ainsi que des <strong>associations SCTP</strong>.</td>
        </tr>
        <tr>
          <td><code>fermé</code></td>
          <td>Lorsque le port est indiqué comme fermé, le protocole TCP indique que le paquet que nous avons reçu contient un drapeau <code>RST</code>. Cette méthode de balayage peut également être utilisée pour déterminer si notre cible est vivante ou non.</td>
        </tr>
        <tr>
          <td><code>filtré</code></td>
          <td>Nmap ne peut pas identifier correctement si le port scanné est ouvert ou fermé car aucune réponse n'est renvoyée par la cible pour le port ou nous recevons un code d'erreur de la cible.</td>
        </tr>
        <tr>
          <td><code>non filtré</code></td>
          <td>Cet état d'un port ne se produit que pendant le scan <strong>TCP-ACK</strong> et signifie que le port est accessible, mais on ne peut pas déterminer s'il est ouvert ou fermé.</td>
        </tr>
        <tr>
          <td><code>ouvert|filtré</code></td>
          <td>Si nous ne recevons pas de réponse pour un port spécifique, <code>Nmap</code> le définira à cet état. Ceci indique qu'un pare-feu ou un filtre de paquets peut protéger le port.</td>
        </tr>
        <tr>
          <td><code>fermé|filtré</code></td>
          <td>Cet état ne se produit que dans les scans <strong>IP ID idle</strong> et indique qu'il était impossible de déterminer si le port scanné est fermé ou filtré par un pare-feu.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <h3 id="discovering-open-tcp-ports">Découvrir les ports TCP ouverts</h3>
    <p>Par défaut, <code>Nmap</code> scanne les 1000 premiers ports TCP avec le scan SYN (<code>-sS</code>). Ce scan SYN est défini par défaut uniquement lorsque nous l'exécutons en tant que root en raison des autorisations de socket nécessaires pour créer des paquets TCP bruts. Sinon, le scan TCP (<code>-sT</code>) est effectué par défaut. Cela signifie que si nous ne définissons pas de ports et de méthodes de balayage, ces paramètres sont définis automatiquement. Nous pouvons définir les ports un par un (<code>-p 22,25,80,139,445</code>), par plage (<code>-p 22-445</code>), par les ports les plus fréquents (<code>--top-ports=10</code>) de la base de données <code>Nmap</code> qui ont été désignés comme les plus fréquents, en scannant tous les ports (<code>-p-</code>) mais aussi en définissant un scan de port rapide, qui contient les 100 ports les plus courants (<code>-F</code>).</p>
    <p><strong>Scanner les 10 principaux ports TCP</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span> <span class="hljs-comment">--top-ports=10 </span>

Starting Nmap <span class="hljs-number">7.80</span> ( <span class="hljs-keyword">https</span>://nmap.org ) <span class="hljs-keyword">at</span> <span class="hljs-number">2020</span><span class="hljs-number">-06</span><span class="hljs-number">-15</span> <span class="hljs-number">15</span>:<span class="hljs-number">36</span> CEST
Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span>
Host is up (<span class="hljs-number">0.021</span>s latency).

PORT     STATE    SERVICE
<span class="hljs-number">21</span>/tcp   closed   <span class="hljs-keyword">ftp</span>
<span class="hljs-number">22</span>/tcp   <span class="hljs-built_in">open</span>     ssh
<span class="hljs-number">23</span>/tcp   closed   telnet
<span class="hljs-number">25</span>/tcp   <span class="hljs-built_in">open</span>     smtp
<span class="hljs-number">80</span>/tcp   <span class="hljs-built_in">open</span>     <span class="hljs-keyword">http</span>
<span class="hljs-number">110</span>/tcp  <span class="hljs-built_in">open</span>     pop3
<span class="hljs-number">139</span>/tcp  filtered netbios-ssn
<span class="hljs-number">443</span>/tcp  closed   <span class="hljs-keyword">https</span>
<span class="hljs-number">445</span>/tcp  filtered microsoft-ds
<span class="hljs-number">3389</span>/tcp closed   ms-wbt-server
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">1.44</span> <span class="hljs-built_in">seconds</span>
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>--top-ports=10</code></td>
          <td>Scanne les ports les plus fréquents spécifiés.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous voyons que nous avons seulement scanné les 10 principaux ports TCP de notre cible, et <code>Nmap</code> affiche leur état en conséquence. Si nous traçons les paquets que <code>Nmap</code> envoie, nous verrons le drapeau <code>RST</code> sur le <code>port TCP 21</code> que notre cible nous renvoie. Pour avoir une vue claire du scan SYN, nous désactivons les requêtes ICMP echo (<code>-Pn</code>), la résolution DNS (<code>-n</code>) et le scan ping ARP (<code>--disable-arp-ping</code>).</p>
    <p><strong>Nmap - Tracer les paquets</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">21</span> --packet-trace -Pn -n --disable-arp-ping

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">39</span> CEST
SENT (<span class="hljs-number">0.</span>0429s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">63090</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">21</span> S ttl=<span class="hljs-number">56</span> id=<span class="hljs-number">57322</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">1699105818</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
RCVD (<span class="hljs-number">0.</span>0573s) TCP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">21</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">63090</span> RA ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">0</span> iplen=<span class="hljs-number">40</span>  seq=<span class="hljs-number">0</span> win=<span class="hljs-number">0</span>
Nmap scan report for <span class="hljs-number">10.11</span><span class="hljs-meta">.1</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>014s latency).

PORT   STATE  SERVICE
<span class="hljs-number">21</span>/tcp closed ftp
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.07</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-p 21</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous pouvons voir à partir de la ligne SENT que nous (<code>10.10.14.2</code>) avons envoyé un paquet TCP avec le drapeau <code>SYN</code> (<code>S</code>) à notre cible (<code>10.129.2.28</code>). Dans la ligne RCVD suivante, nous pouvons voir que la cible répond avec un paquet TCP contenant les drapeaux <code>RST</code> et <code>ACK</code> (<code>RA</code>). Les drapeaux <code>RST</code> et <code>ACK</code> sont utilisés pour accuser réception du paquet TCP (<code>ACK</code>) et pour mettre fin à la session TCP (<code>RST</code>).</p>
    <p><strong>Requête</strong></p>
    <table>
      <thead>
        <tr>
          <th><strong>Message</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>SENT (0.0429s)</code></td>
          <td>Indique l'opération SENT de Nmap, qui envoie un paquet à la cible.</td>
        </tr>
        <tr>
          <td><code>TCP</code></td>
          <td>Montre le protocole utilisé pour interagir avec le port cible.</td>
        </tr>
        <tr>
          <td><code>10.10.14.2:63090 &gt;</code></td>
          <td>Représente notre adresse IPv4 et le port source, qui seront utilisés par Nmap pour envoyer les paquets.</td>
        </tr>
        <tr>
          <td><code>10.129.2.28:21</code></td>
          <td>Montre l'adresse IPv4 cible et le port cible.</td>
        </tr>
        <tr>
          <td><code>S</code></td>
          <td>Drapeau SYN du paquet TCP envoyé.</td>
        </tr>
        <tr>
          <td><code>ttl=56 id=57322 iplen=44 seq=1699105818 win=1024 mss 1460</code></td>
          <td>Paramètres supplémentaires de l'en-tête TCP.</td>
        </tr>
      </tbody>
    </table>
    <p><strong>Réponse</strong></p>
    <table>
      <thead>
        <tr>
          <th><strong>Message</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>RCVD (0.0573s)</code></td>
          <td>Indique un paquet reçu de la cible.</td>
        </tr>
        <tr>
          <td><code>TCP</code></td>
          <td>Montre le protocole utilisé.</td>
        </tr>
        <tr>
          <td><code>10.129.2.28:21 &gt;</code></td>
          <td>Représente l'adresse IPv4 de la cible et le port source, qui sera utilisé pour répondre.</td>
        </tr>
        <tr>
          <td><code>10.10.14.2:63090</code></td>
          <td>Montre notre adresse IPv4 et le port auquel répondre.</td>
        </tr>
        <tr>
          <td><code>RA</code></td>
          <td>Drapeaux RST et ACK du paquet TCP envoyé.</td>
        </tr>
        <tr>
          <td><code>ttl=64 id=0 iplen=40 seq=0 win=0</code></td>
          <td>Paramètres supplémentaires de l'en-tête TCP.</td>
        </tr>
      </tbody>
    </table>
    <p><strong>Scan Connect</strong></p>
    <p>Le <a href="https://nmap.org/book/scan-methods-connect-scan.html">scan TCP Connect</a> de Nmap (<code>-sT</code>) utilise le handshake TCP à trois voies pour déterminer si un port spécifique sur un hôte cible est ouvert ou fermé. Le scan envoie un paquet <code>SYN</code> au port cible et attend une réponse. Il est considéré comme ouvert si le port cible répond avec un paquet <code>SYN-ACK</code> et fermé s'il répond avec un paquet <code>RST</code>.</p>
    <p>Le scan <code>Connect</code> est utile car c'est le moyen le plus précis de déterminer l'état d'un port, et il est aussi le plus discret. Contrairement à d'autres types de scans, comme le scan SYN, le scan Connect ne laisse aucune connexion non terminée ou paquet non envoyé sur l'hôte cible, ce qui le rend moins susceptible d'être détecté par les systèmes de détection d'intrusion (IDS) ou les systèmes de prévention d'intrusion (IPS). Il est utile lorsque nous voulons cartographier le réseau et ne pas perturber les services qui y sont exécutés, causant ainsi un impact minimal et étant parfois considéré comme une méthode de scan plus polie.</p>
    <p>Il est également utile lorsque l'hôte cible a un pare-feu personnel qui supprime les paquets entrants mais autorise les paquets sortants. Dans ce cas, un scan Connect peut contourner le pare-feu et déterminer avec précision l'état des ports cibles. Cependant, il est important de noter que le scan Connect est plus lent que les autres types de scans car il oblige le scanner à attendre une réponse de la cible après chaque paquet qu'il envoie, ce qui pourrait prendre un certain temps si la cible est occupée ou ne répond pas.</p>
    <p><strong>Scan Connect sur le port TCP 443</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">443</span> --packet-trace --disable-arp-ping -Pn -n --reason -<span class="hljs-built_in">sT</span> 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">26</span> CET
CONN (<span class="hljs-number">0.</span>0385s) TCP localhost &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">443</span> =&gt; Operation now <span class="hljs-keyword">in</span> progress
CONN (<span class="hljs-number">0.</span>0396s) TCP localhost &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">443</span> =&gt; Connected
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>013s latency).

PORT    STATE SERVICE REASON
<span class="hljs-number">443</span>/tcp open  https   syn-ack

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.04</span> seconds
</code></pre>
    <hr>
    <h3 id="filtered-ports">Ports filtrés</h3>
    <p>Lorsqu'un port est indiqué comme filtré, cela peut avoir plusieurs raisons. Dans la plupart des cas, les pare-feu ont certaines règles définies pour gérer des connexions spécifiques. Les paquets peuvent être soit <code>abandonnés</code>, soit <code>rejetés</code>. Lorsqu'un paquet est abandonné, <code>Nmap</code> ne reçoit aucune réponse de notre cible, et par défaut, le taux de nouvelle tentative (<code>--max-retries</code>) est fixé à 1. Cela signifie que <code>Nmap</code> renverra la demande au port cible pour déterminer si le paquet précédent n'a pas été accidentellement mal géré.</p>
    <p>Examinons un exemple où le pare-feu <code>abandonne</code> les paquets TCP que nous envoyons pour le scan de port. Par conséquent, nous scannons le port TCP <strong>139</strong>, qui a déjà été indiqué comme filtré. Pour pouvoir suivre comment nos paquets envoyés sont traités, nous désactivons à nouveau les requêtes ICMP echo (<code>-Pn</code>), la résolution DNS (<code>-n</code>) et le scan ping ARP (<code>--disable-arp-ping</code>).</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">139</span> --packet-trace -n --disable-arp-ping -Pn

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">45</span> CEST
SENT (<span class="hljs-number">0.</span>0381s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">60277</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">139</span> S ttl=<span class="hljs-number">47</span> id=<span class="hljs-number">14523</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">4175236769</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
SENT (<span class="hljs-number">1.</span>0411s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">60278</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">139</span> S ttl=<span class="hljs-number">45</span> id=<span class="hljs-number">7372</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">4175171232</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>.

PORT    STATE    SERVICE
<span class="hljs-number">139</span>/tcp filtered netbios-ssn
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">2.06</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-p 139</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous voyons dans le dernier scan que <code>Nmap</code> a envoyé deux paquets TCP avec le drapeau SYN. Par la durée (<code>2.06s</code>) du scan, nous pouvons reconnaître que cela a pris beaucoup plus de temps que les précédents (<code>~0.05s</code>). Le cas est différent si le pare-feu rejette les paquets. Pour cela, nous regardons le port TCP <code>445</code>, qui est traité en conséquence par une telle règle du pare-feu.</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">445</span> --packet-trace -n --disable-arp-ping -Pn

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">55</span> CEST
SENT (<span class="hljs-number">0.</span>0388s) TCP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">52472</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> S ttl=<span class="hljs-number">49</span> id=<span class="hljs-number">21763</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">1418633433</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
RCVD (<span class="hljs-number">0.</span>0487s) ICMP [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> Port <span class="hljs-number">445</span> unreachable (type=<span class="hljs-number">3</span>/code=<span class="hljs-number">3</span>) ] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">20998</span> iplen=<span class="hljs-number">72</span> ]
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>0099s latency).

PORT    STATE    SERVICE
<span class="hljs-number">445</span>/tcp filtered microsoft-<span class="hljs-built_in">ds</span>
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.05</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-p 445</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
      </tbody>
    </table>
    <p>En réponse, nous recevons une réponse <code>ICMP</code> avec <code>type 3</code> et <code>code d'erreur 3</code>, ce qui indique que le port souhaité est inaccessible. Néanmoins, si nous savons que l'hôte est vivant, nous pouvons fortement supposer que le pare-feu sur ce port rejette les paquets, et nous devrons examiner ce port de plus près plus tard.</p>
    <hr>
    <h3 id="discovering-open-udp-ports">Découvrir les ports UDP ouverts</h3>
    <p>Certains administrateurs système oublient parfois de filtrer les ports UDP en plus des ports TCP. Comme <code>UDP</code> est un protocole <code>sans état</code> et ne nécessite pas de handshake à trois voies comme TCP. Nous ne recevons aucun accusé de réception. Par conséquent, le timeout est beaucoup plus long, ce qui rend l'ensemble du <code>scan UDP</code> (<code>-sU</code>) beaucoup plus lent que le <code>scan TCP</code> (<code>-sS</code>).</p>
    <p>Regardons un exemple de ce à quoi peut ressembler un scan UDP (<code>-sU</code>) et les résultats qu'il nous donne.</p>
    <p><strong>Scan de port UDP</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo <span class="hljs-keyword">nmap</span> <span class="hljs-number">10.129</span>.<span class="hljs-number">2.28</span> -F -sU

Starting Nmap <span class="hljs-number">7.80</span> ( http<span class="hljs-variable">s:</span>//<span class="hljs-keyword">nmap</span>.org ) at <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> CEST
Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span>.<span class="hljs-number">2.28</span>
Host <span class="hljs-keyword">is</span> <span class="hljs-keyword">up</span> (<span class="hljs-number">0.059</span>s latency).
Not shown: <span class="hljs-number">95</span> closed ports
PORT     STATE         SERVICE
<span class="hljs-number">68</span>/udp   <span class="hljs-keyword">open</span>|filtered dhcpc
<span class="hljs-number">137</span>/udp  <span class="hljs-keyword">open</span>          netbios-ns
<span class="hljs-number">138</span>/udp  <span class="hljs-keyword">open</span>|filtered netbios-dgm
<span class="hljs-number">631</span>/udp  <span class="hljs-keyword">open</span>|filtered ipp
<span class="hljs-number">5353</span>/udp <span class="hljs-keyword">open</span>          zeroconf
MAC Addres<span class="hljs-variable">s:</span> DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host <span class="hljs-keyword">up</span>) scanned in <span class="hljs-number">98.07</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-F</code></td>
          <td>Scanne les 100 ports les plus courants.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Un autre inconvénient est que nous n'obtenons souvent pas de réponse car <code>Nmap</code> envoie des datagrammes vides aux ports UDP scannés, et nous ne recevons aucune réponse. Nous ne pouvons donc pas déterminer si le paquet UDP est arrivé ou non. Si le port UDP est <code>ouvert</code>, nous n'obtenons une réponse que si l'application est configurée pour le faire.</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -sU -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">137</span> --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">15</span> CEST
SENT (<span class="hljs-number">0.</span>0367s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">55478</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">137</span> ttl=<span class="hljs-number">57</span> id=<span class="hljs-number">9122</span> iplen=<span class="hljs-number">78</span>
RCVD (<span class="hljs-number">0.</span>0398s) UDP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">137</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">55478</span> ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">13222</span> iplen=<span class="hljs-number">257</span>
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>0031s latency).

PORT    STATE SERVICE    REASON
<span class="hljs-number">137</span>/udp open  netbios-ns udp-response ttl <span class="hljs-number">64</span>
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.04</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 137</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Si nous obtenons une réponse ICMP avec le <code>code d'erreur 3</code> (port inaccessible), nous savons que le port est effectivement <code>fermé</code>.</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -sU -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">100</span> --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">25</span> CEST
SENT (<span class="hljs-number">0.</span>0445s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">63825</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">100</span> ttl=<span class="hljs-number">57</span> id=<span class="hljs-number">29925</span> iplen=<span class="hljs-number">28</span>
RCVD (<span class="hljs-number">0.</span>1498s) ICMP [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span> Port unreachable (type=<span class="hljs-number">3</span>/code=<span class="hljs-number">3</span>) ] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">11903</span> iplen=<span class="hljs-number">56</span> ]
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>11s latency).

PORT    STATE  SERVICE REASON
<span class="hljs-number">100</span>/udp closed unknown port-unreach ttl <span class="hljs-number">64</span>
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span>  <span class="hljs-number">0.15</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 100</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Pour toutes les autres réponses ICMP, les ports scannés sont marqués comme (<code>ouvert|filtré</code>).</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -sU -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">138</span> --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">32</span> CEST
SENT (<span class="hljs-number">0.</span>0380s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">52341</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">138</span> ttl=<span class="hljs-number">50</span> id=<span class="hljs-number">65159</span> iplen=<span class="hljs-number">28</span>
SENT (<span class="hljs-number">1.</span>0392s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">52342</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">138</span> ttl=<span class="hljs-number">40</span> id=<span class="hljs-number">24444</span> iplen=<span class="hljs-number">28</span>
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set.

PORT    STATE         SERVICE     REASON
<span class="hljs-number">138</span>/udp open|filtered netbios-dgm no-response
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">2.06</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 138</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
      </tbody>
    </table>
    <p>Une autre méthode pratique pour scanner les ports est l'option <code>-sV</code> qui permet d'obtenir des informations supplémentaires disponibles sur les ports ouverts. Cette méthode peut identifier les versions, les noms de services et des détails sur notre cible.</p>
    <p><strong>Scan de version</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">445</span> --reason  -sV

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2022</span>-<span class="hljs-number">11</span>-<span class="hljs-number">04</span> <span class="hljs-number">11</span>:<span class="hljs-number">10</span> GMT
SENT (<span class="hljs-number">0.</span>3426s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">44641</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> S ttl=<span class="hljs-number">55</span> id=<span class="hljs-number">43401</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">3589068008</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
RCVD (<span class="hljs-number">0.</span>3556s) TCP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">44641</span> SA ttl=<span class="hljs-number">63</span> id=<span class="hljs-number">0</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">2881527699</span> win=<span class="hljs-number">29200</span> &lt;mss <span class="hljs-number">1337</span>&gt;
NSOCK INFO [<span class="hljs-number">0.</span>4980s] nsock_iod_new2(): nsock_iod_new (IOD #<span class="hljs-number">1</span>)
NSOCK INFO [<span class="hljs-number">0.</span>4980s] nsock_connect_tcp(): TCP connection requested to <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> (IOD #<span class="hljs-number">1</span>) EID <span class="hljs-number">8</span>
NSOCK INFO [<span class="hljs-number">0.</span>5130s] nsock_trace_handler_callback(): Callback: CONNECT SUCCESS for EID <span class="hljs-number">8</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
Service scan sending probe NULL to <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> (tcp)
NSOCK INFO [<span class="hljs-number">0.</span>5130s] nsock_read(): Read request from IOD #<span class="hljs-number">1</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>] (timeout: 6000ms) EID <span class="hljs-number">18</span>
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_trace_handler_callback(): Callback: READ TIMEOUT for EID <span class="hljs-number">18</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
Service scan sending probe SMBProgNeg to <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> (tcp)
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_write(): Write request for <span class="hljs-number">168</span> bytes to IOD #<span class="hljs-number">1</span> EID <span class="hljs-number">27</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_read(): Read request from IOD #<span class="hljs-number">1</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>] (timeout: 5000ms) EID <span class="hljs-number">34</span>
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_trace_handler_callback(): Callback: WRITE SUCCESS for EID <span class="hljs-number">27</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
NSOCK INFO [<span class="hljs-number">6.</span>5320s] nsock_trace_handler_callback(): Callback: READ SUCCESS for EID <span class="hljs-number">34</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>] (<span class="hljs-number">135</span> bytes)
Service scan match (Probe SMBProgNeg matched with SMBProgNeg line <span class="hljs-number">13836</span>): <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> is netbios-ssn.  Version: |Samba smbd|<span class="hljs-number">3.</span>X - <span class="hljs-number">4.</span>X|workgroup: WORKGROUP|
NSOCK INFO [<span class="hljs-number">6.</span>5320s] nsock_iod_delete(): nsock_iod_delete (IOD #<span class="hljs-number">1</span>)
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>013s latency).

PORT    STATE SERVICE     REASON         VERSION
<span class="hljs-number">445</span>/tcp open  netbios-ssn syn-ack ttl <span class="hljs-number">63</span> Samba smbd <span class="hljs-number">3.</span>X - <span class="hljs-number">4.</span>X (workgroup: WORKGROUP)
Service Info: Host: Ubuntu

Service detection performed. Please report any incorrect results <span class="hljs-meta">at</span> https://nmap.org/submit/ .
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">6.55</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 445</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
        <tr>
          <td><code>-sV</code></td>
          <td>Effectue un scan de service.</td>
        </tr>
      </tbody>
    </table>
    <p>Plus d'informations sur les techniques de balayage de ports peuvent être trouvées à : <a href="https://nmap.org/book/man-port-scanning-techniques.html">https://nmap.org/book/man-port-scanning-techniques.html</a></p>
    <h2 id="host-discovery">Découverte d'hôtes</h2>
    <hr>
    <p>Lorsque nous devons effectuer un test d'intrusion interne pour l'ensemble du réseau d'une entreprise, par exemple, nous devons d'abord obtenir un aperçu des systèmes en ligne avec lesquels nous pouvons travailler. Pour découvrir activement ces systèmes sur le réseau, nous pouvons utiliser diverses options de découverte d'hôtes de <code>Nmap</code>. Il existe de nombreuses options que <code>Nmap</code> fournit pour déterminer si notre cible est active ou non. La méthode de découverte d'hôtes la plus efficace consiste à utiliser des <strong>requêtes ICMP echo</strong>, que nous allons examiner.</p>
    <p>Il est toujours recommandé de stocker chaque scan. Cela peut ensuite être utilisé pour des comparaisons, de la documentation et des rapports. Après tout, différents outils peuvent produire des résultats différents. Par conséquent, il peut être avantageux de distinguer quel outil produit quels résultats.</p>
    <p><strong>Balayer une plage réseau</strong></p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span> -sn -oA tnet | grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.4</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.11</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span>
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.0/24</code></td>
          <td>Plage réseau cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA tnet</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'tnet'.</td>
        </tr>
      </tbody>
    </table>
    <p>Cette méthode de balayage fonctionne uniquement si les pare-feu des hôtes le permettent. Sinon, nous pouvons utiliser d'autres techniques de balayage pour savoir si les hôtes sont actifs ou non. Nous examinerons de plus près ces techniques dans "<code>Contournement de pare-feu et IDS</code>".</p>
    <hr>
    <h3 id="scan-ip-list">Balayer une liste d'IP</h3>
    <p>Lors d'un test d'intrusion interne, il n'est pas rare qu'on nous fournisse une liste d'IP avec les hôtes que nous devons tester. <code>Nmap</code> nous donne également la possibilité de travailler avec des listes et de lire les hôtes de cette liste au lieu de les définir ou de les saisir manuellement.</p>
    <p>Une telle liste pourrait ressembler à ceci :</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ cat hosts.lst

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.4</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.10</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.11</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span>
</code></pre>
    <p>Si nous utilisons la même technique de balayage sur la liste prédéfinie, la commande ressemblera à ceci :</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA tnet</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'tnet'.</td>
        </tr>
        <tr>
          <td><code>-iL</code></td>
          <td>Effectue les scans définis contre les cibles dans la liste 'hosts.lst' fournie.</td>
        </tr>
      </tbody>
    </table>
    <p>Dans cet exemple, nous voyons que seulement 3 des 7 hôtes sont actifs. Rappelez-vous, cela peut signifier que les autres hôtes ignorent les <strong>requêtes ICMP echo</strong> par défaut à cause de leurs configurations de pare-feu. Comme <code>Nmap</code> ne reçoit pas de réponse, il marque ces hôtes comme inactifs.</p>
    <hr>
    <h3 id="scan-multiple-ips">Balayer plusieurs IP</h3>
    <p>Il peut aussi arriver que nous ayons besoin de scanner une petite partie d'un réseau. Une alternative à la méthode que nous avons utilisée la dernière fois est de spécifier plusieurs adresses IP.</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap -sn -oA tnet <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>| grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
</code></pre>
    <p>Si ces adresses IP sont côte à côte, nous pouvons également définir la plage dans l'octet respectif.</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap -sn -oA tnet <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span><span class="hljs-number">-20</span>| grep for | cut -d<span class="hljs-string">" "</span> -f5

<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.19</span>
<span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.20</span>
</code></pre>
    <hr>
    <h3 id="scan-single-ip">Balayer une IP unique</h3>
    <p>Avant de scanner un hôte unique pour ses ports ouverts et ses services, nous devons d'abord déterminer s'il est vivant ou non. Pour cela, nous pouvons utiliser la même méthode qu'avant.</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span> -sn -oA host 

Starting Nmap <span class="hljs-number">7.80</span> ( <span class="hljs-string">https:</span><span class="hljs-comment">//nmap.org ) at 2020-06-14 23:59 CEST</span>
Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.18</span>
Host is up (<span class="hljs-number">0.087</span>s latency).
MAC <span class="hljs-string">Address:</span> <span class="hljs-string">DE:</span><span class="hljs-string">AD:</span><span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-string">BE:</span>EF
Nmap <span class="hljs-string">done:</span> <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.11</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.18</code></td>
          <td>Effectue les scans définis contre la cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA host</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'host'.</td>
        </tr>
      </tbody>
    </table>
    <p>Si nous désactivons le scan de ports (<code>-sn</code>), Nmap effectue automatiquement un ping scan avec des <code>Requêtes ICMP Echo</code> (<code>-PE</code>). Une fois qu'une telle requête est envoyée, nous nous attendons généralement à une <code>réponse ICMP</code> si l'hôte pingué est vivant. Le fait le plus intéressant est que nos scans précédents ne l'ont pas fait car avant que Nmap puisse envoyer une requête ICMP echo, il enverrait un <code>ping ARP</code> aboutissant à une <code>réponse ARP</code>. Nous pouvons le confirmer avec l'option "<code>--packet-trace</code>". Pour s'assurer que les requêtes ICMP echo sont envoyées, nous définissons également l'option (<code>-PE</code>) pour cela.</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> -sn -oA host -PE --packet-trace 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">00</span>:<span class="hljs-number">08</span> CEST
SENT (<span class="hljs-number">0.</span>0074s) ARP who-has <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> tell <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>
RCVD (<span class="hljs-number">0.</span>0309s) ARP reply <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> is-<span class="hljs-meta">at</span> DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>023s latency).
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.05</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.18</code></td>
          <td>Effectue les scans définis contre la cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA host</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'host'.</td>
        </tr>
        <tr>
          <td><code>-PE</code></td>
          <td>Effectue le ping scan en utilisant des 'requêtes ICMP Echo' contre la cible.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Montre tous les paquets envoyés et reçus</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Une autre façon de déterminer pourquoi Nmap a marqué notre cible comme "vivante" est avec l'option "<code>--reason</code>".</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> -sn -oA host -PE --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">00</span>:<span class="hljs-number">10</span> CEST
SENT (<span class="hljs-number">0.</span>0074s) ARP who-has <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> tell <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>
RCVD (<span class="hljs-number">0.</span>0309s) ARP reply <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> is-<span class="hljs-meta">at</span> DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span>
Host is <span class="hljs-meta">up</span>, received arp-response (<span class="hljs-number">0.</span>028s latency).
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.03</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.18</code></td>
          <td>Effectue les scans définis contre la cible.</td>
        </tr>
        <tr>
          <td><code>-sn</code></td>
          <td>Désactive le balayage de ports.</td>
        </tr>
        <tr>
          <td><code>-oA host</code></td>
          <td>Stocke les résultats dans tous les formats, en commençant par le nom 'host'.</td>
        </tr>
        <tr>
          <td><code>-PE</code></td>
          <td>Effectue le ping scan en utilisant des 'requêtes ICMP Echo' contre la cible.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison d'un résultat spécifique.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous voyons ici que <code>Nmap</code> détecte en effet si l'hôte est vivant ou non uniquement par la <code>requête ARP</code> et la <code>réponse ARP</code>. Pour désactiver les requêtes ARP et scanner notre cible avec les <code>requêtes ICMP echo</code> souhaitées, nous pouvons désactiver les pings ARP en définissant l'option "<code>--disable-arp-ping</code>". Ensuite, nous pouvons scanner à nouveau notre cible et examiner les paquets envoyés et reçus.</p>
    <p>Découverte d'hôtes</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> -sn -oA host -PE --packet-trace --disable-arp-ping 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">00</span>:<span class="hljs-number">12</span> CEST
SENT (<span class="hljs-number">0.</span>0107s) ICMP [<span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> Echo request (type=<span class="hljs-number">8</span>/code=<span class="hljs-number">0</span>) id=<span class="hljs-number">13607</span> seq=<span class="hljs-number">0</span>] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">255</span> id=<span class="hljs-number">23541</span> iplen=<span class="hljs-number">28</span> ]
RCVD (<span class="hljs-number">0.</span>0152s) ICMP [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.18</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span> Echo reply (type=<span class="hljs-number">0</span>/code=<span class="hljs-number">0</span>) id=<span class="hljs-number">13607</span> seq=<span class="hljs-number">0</span>] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">128</span> id=<span class="hljs-number">40622</span> iplen=<span class="hljs-number">28</span> ]
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>086s latency).
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.11</span> seconds
</code></pre>
    <p>Nous avons déjà mentionné dans le "<code>Processus d'apprentissage</code>" et au début de ce module qu'il est essentiel de prêter attention aux détails. Une <code>requête ICMP echo</code> peut nous aider à déterminer si notre cible est vivante et à identifier son système. Plus de stratégies sur la découverte d'hôtes peuvent être trouvées à :</p>
    <p><a href="https://nmap.org/book/host-discovery-strategies.html">https://nmap.org/book/host-discovery-strategies.html</a></p>
    <h2 id="host-and-port-scanning">Balayage d'hôtes et de ports</h2>
    <hr>
    <p>Il est essentiel de comprendre comment l'outil que nous utilisons fonctionne et comment il exécute et traite les différentes fonctions. Nous ne comprendrons les résultats que si nous savons ce qu'ils signifient et comment ils sont obtenus. Par conséquent, nous allons examiner et analyser de plus près certaines des méthodes de balayage. Après avoir découvert que notre cible est vivante, nous voulons obtenir une image plus précise du système. Les informations dont nous avons besoin incluent :</p>
    <ul>
      <li>Ports ouverts et leurs services</li>
      <li>Versions des services</li>
      <li>Informations fournies par les services</li>
      <li>Système d'exploitation</li>
    </ul>
    <p>Il y a un total de 6 états différents pour un port scanné que nous pouvons obtenir :</p>
    <table>
      <thead>
        <tr>
          <th><strong>État</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>ouvert</code></td>
          <td>Ceci indique que la connexion au port scanné a été établie. Ces connexions peuvent être des <strong>connexions TCP</strong>, des <strong>datagrammes UDP</strong> ainsi que des <strong>associations SCTP</strong>.</td>
        </tr>
        <tr>
          <td><code>fermé</code></td>
          <td>Lorsque le port est indiqué comme fermé, le protocole TCP indique que le paquet que nous avons reçu contient un drapeau <code>RST</code>. Cette méthode de balayage peut également être utilisée pour déterminer si notre cible est vivante ou non.</td>
        </tr>
        <tr>
          <td><code>filtré</code></td>
          <td>Nmap ne peut pas identifier correctement si le port scanné est ouvert ou fermé car aucune réponse n'est renvoyée par la cible pour le port ou nous recevons un code d'erreur de la cible.</td>
        </tr>
        <tr>
          <td><code>non filtré</code></td>
          <td>Cet état d'un port ne se produit que pendant le scan <strong>TCP-ACK</strong> et signifie que le port est accessible, mais on ne peut pas déterminer s'il est ouvert ou fermé.</td>
        </tr>
        <tr>
          <td><code>ouvert|filtré</code></td>
          <td>Si nous ne recevons pas de réponse pour un port spécifique, <code>Nmap</code> le définira à cet état. Ceci indique qu'un pare-feu ou un filtre de paquets peut protéger le port.</td>
        </tr>
        <tr>
          <td><code>fermé|filtré</code></td>
          <td>Cet état ne se produit que dans les scans <strong>IP ID idle</strong> et indique qu'il était impossible de déterminer si le port scanné est fermé ou filtré par un pare-feu.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <h3 id="discovering-open-tcp-ports">Découvrir les ports TCP ouverts</h3>
    <p>Par défaut, <code>Nmap</code> scanne les 1000 premiers ports TCP avec le scan SYN (<code>-sS</code>). Ce scan SYN est défini par défaut uniquement lorsque nous l'exécutons en tant que root en raison des autorisations de socket nécessaires pour créer des paquets TCP bruts. Sinon, le scan TCP (<code>-sT</code>) est effectué par défaut. Cela signifie que si nous ne définissons pas de ports et de méthodes de balayage, ces paramètres sont définis automatiquement. Nous pouvons définir les ports un par un (<code>-p 22,25,80,139,445</code>), par plage (<code>-p 22-445</code>), par les ports les plus fréquents (<code>--top-ports=10</code>) de la base de données <code>Nmap</code> qui ont été désignés comme les plus fréquents, en scannant tous les ports (<code>-p-</code>) mais aussi en définissant un scan de port rapide, qui contient les 100 ports les plus courants (<code>-F</code>).</p>
    <p><strong>Scanner les 10 principaux ports TCP</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span> <span class="hljs-comment">--top-ports=10 </span>

Starting Nmap <span class="hljs-number">7.80</span> ( <span class="hljs-keyword">https</span>://nmap.org ) <span class="hljs-keyword">at</span> <span class="hljs-number">2020</span><span class="hljs-number">-06</span><span class="hljs-number">-15</span> <span class="hljs-number">15</span>:<span class="hljs-number">36</span> CEST
Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span>
Host is up (<span class="hljs-number">0.021</span>s latency).

PORT     STATE    SERVICE
<span class="hljs-number">21</span>/tcp   closed   <span class="hljs-keyword">ftp</span>
<span class="hljs-number">22</span>/tcp   <span class="hljs-built_in">open</span>     ssh
<span class="hljs-number">23</span>/tcp   closed   telnet
<span class="hljs-number">25</span>/tcp   <span class="hljs-built_in">open</span>     smtp
<span class="hljs-number">80</span>/tcp   <span class="hljs-built_in">open</span>     <span class="hljs-keyword">http</span>
<span class="hljs-number">110</span>/tcp  <span class="hljs-built_in">open</span>     pop3
<span class="hljs-number">139</span>/tcp  filtered netbios-ssn
<span class="hljs-number">443</span>/tcp  closed   <span class="hljs-keyword">https</span>
<span class="hljs-number">445</span>/tcp  filtered microsoft-ds
<span class="hljs-number">3389</span>/tcp closed   ms-wbt-server
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">1.44</span> <span class="hljs-built_in">seconds</span>
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>--top-ports=10</code></td>
          <td>Scanne les ports les plus fréquents spécifiés.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous voyons que nous avons seulement scanné les 10 principaux ports TCP de notre cible, et <code>Nmap</code> affiche leur état en conséquence. Si nous traçons les paquets que <code>Nmap</code> envoie, nous verrons le drapeau <code>RST</code> sur le <code>port TCP 21</code> que notre cible nous renvoie. Pour avoir une vue claire du scan SYN, nous désactivons les requêtes ICMP echo (<code>-Pn</code>), la résolution DNS (<code>-n</code>) et le scan ping ARP (<code>--disable-arp-ping</code>).</p>
    <p><strong>Nmap - Tracer les paquets</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">21</span> --packet-trace -Pn -n --disable-arp-ping

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">39</span> CEST
SENT (<span class="hljs-number">0.</span>0429s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">63090</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">21</span> S ttl=<span class="hljs-number">56</span> id=<span class="hljs-number">57322</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">1699105818</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
RCVD (<span class="hljs-number">0.</span>0573s) TCP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">21</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">63090</span> RA ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">0</span> iplen=<span class="hljs-number">40</span>  seq=<span class="hljs-number">0</span> win=<span class="hljs-number">0</span>
Nmap scan report for <span class="hljs-number">10.11</span><span class="hljs-meta">.1</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>014s latency).

PORT   STATE  SERVICE
<span class="hljs-number">21</span>/tcp closed ftp
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.07</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-p 21</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous pouvons voir à partir de la ligne SENT que nous (<code>10.10.14.2</code>) avons envoyé un paquet TCP avec le drapeau <code>SYN</code> (<code>S</code>) à notre cible (<code>10.129.2.28</code>). Dans la ligne RCVD suivante, nous pouvons voir que la cible répond avec un paquet TCP contenant les drapeaux <code>RST</code> et <code>ACK</code> (<code>RA</code>). Les drapeaux <code>RST</code> et <code>ACK</code> sont utilisés pour accuser réception du paquet TCP (<code>ACK</code>) et pour mettre fin à la session TCP (<code>RST</code>).</p>
    <p><strong>Requête</strong></p>
    <table>
      <thead>
        <tr>
          <th><strong>Message</strong></th>
          <strong>Description</strong>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>SENT (0.0429s)</code></td>
          <td>Indique l'opération SENT de Nmap, qui envoie un paquet à la cible.</td>
        </tr>
        <tr>
          <td><code>TCP</code></td>
          <td>Montre le protocole utilisé pour interagir avec le port cible.</td>
        </tr>
        <tr>
          <td><code>10.10.14.2:63090 &gt;</code></td>
          <td>Représente notre adresse IPv4 et le port source, qui seront utilisés par Nmap pour envoyer les paquets.</td>
        </tr>
        <tr>
          <td><code>10.129.2.28:21</code></td>
          <td>Montre l'adresse IPv4 cible et le port cible.</td>
        </tr>
        <tr>
          <td><code>S</code></td>
          <td>Drapeau SYN du paquet TCP envoyé.</td>
        </tr>
        <tr>
          <td><code>ttl=56 id=57322 iplen=44 seq=1699105818 win=1024 mss 1460</code></td>
          <td>Paramètres supplémentaires de l'en-tête TCP.</td>
        </tr>
      </tbody>
    </table>
    <p><strong>Réponse</strong></p>
    <table>
      <thead>
        <tr>
          <th><strong>Message</strong></th>
          <strong>Description</strong>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>RCVD (0.0573s)</code></td>
          <td>Indique un paquet reçu de la cible.</td>
        </tr>
        <tr>
          <td><code>TCP</code></td>
          <td>Montre le protocole utilisé.</td>
        </tr>
        <tr>
          <td><code>10.129.2.28:21 &gt;</code></td>
          <td>Représente l'adresse IPv4 de la cible et le port source, qui sera utilisé pour répondre.</td>
        </tr>
        <tr>
          <td><code>10.10.14.2:63090</code></td>
          <td>Montre notre adresse IPv4 et le port auquel répondre.</td>
        </tr>
        <tr>
          <td><code>RA</code></td>
          <td>Drapeaux RST et ACK du paquet TCP envoyé.</td>
        </tr>
        <tr>
          <td><code>ttl=64 id=0 iplen=40 seq=0 win=0</code></td>
          <td>Paramètres supplémentaires de l'en-tête TCP.</td>
        </tr>
      </tbody>
    </table>
    <p><strong>Scan Connect</strong></p>
    <p>Le <a href="https://nmap.org/book/scan-methods-connect-scan.html">scan TCP Connect</a> de Nmap (<code>-sT</code>) utilise le handshake TCP à trois voies pour déterminer si un port spécifique sur un hôte cible est ouvert ou fermé. Le scan envoie un paquet <code>SYN</code> au port cible et attend une réponse. Il est considéré comme ouvert si le port cible répond avec un paquet <code>SYN-ACK</code> et fermé s'il répond avec un paquet <code>RST</code>.</p>
    <p>Le scan <code>Connect</code> est utile car c'est le moyen le plus précis de déterminer l'état d'un port, et il est aussi le plus discret. Contrairement à d'autres types de scans, comme le scan SYN, le scan Connect ne laisse aucune connexion non terminée ou paquet non envoyé sur l'hôte cible, ce qui le rend moins susceptible d'être détecté par les systèmes de détection d'intrusion (IDS) ou les systèmes de prévention d'intrusion (IPS). Il est utile lorsque nous voulons cartographier le réseau et ne pas perturber les services qui y sont exécutés, causant ainsi un impact minimal et étant parfois considéré comme une méthode de scan plus polie.</p>
    <p>Il est également utile lorsque l'hôte cible a un pare-feu personnel qui supprime les paquets entrants mais autorise les paquets sortants. Dans ce cas, un scan Connect peut contourner le pare-feu et déterminer avec précision l'état des ports cibles. Cependant, il est important de noter que le scan Connect est plus lent que les autres types de scans car il oblige le scanner à attendre une réponse de la cible après chaque paquet qu'il envoie, ce qui pourrait prendre un certain temps si la cible est occupée ou ne répond pas.</p>
    <p><strong>Scan Connect sur le port TCP 443</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">443</span> --packet-trace --disable-arp-ping -Pn -n --reason -<span class="hljs-built_in">sT</span> 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">26</span> CET
CONN (<span class="hljs-number">0.</span>0385s) TCP localhost &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">443</span> =&gt; Operation now <span class="hljs-keyword">in</span> progress
CONN (<span class="hljs-number">0.</span>0396s) TCP localhost &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">443</span> =&gt; Connected
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>013s latency).

PORT    STATE SERVICE REASON
<span class="hljs-number">443</span>/tcp open  https   syn-ack

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.04</span> seconds
</code></pre>
    <hr>
    <h3 id="filtered-ports">Ports filtrés</h3>
    <p>Lorsqu'un port est indiqué comme filtré, cela peut avoir plusieurs raisons. Dans la plupart des cas, les pare-feu ont certaines règles définies pour gérer des connexions spécifiques. Les paquets peuvent être soit <code>abandonnés</code>, soit <code>rejetés</code>. Lorsqu'un paquet est abandonné, <code>Nmap</code> ne reçoit aucune réponse de notre cible, et par défaut, le taux de nouvelle tentative (<code>--max-retries</code>) est fixé à 1. Cela signifie que <code>Nmap</code> renverra la demande au port cible pour déterminer si le paquet précédent n'a pas été accidentellement mal géré.</p>
    <p>Examinons un exemple où le pare-feu <code>abandonne</code> les paquets TCP que nous envoyons pour le scan de port. Par conséquent, nous scannons le port TCP <strong>139</strong>, qui a déjà été indiqué comme filtré. Pour pouvoir suivre comment nos paquets envoyés sont traités, nous désactivons à nouveau les requêtes ICMP echo (<code>-Pn</code>), la résolution DNS (<code>-n</code>) et le scan ping ARP (<code>--disable-arp-ping</code>).</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">139</span> --packet-trace -n --disable-arp-ping -Pn

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">45</span> CEST
SENT (<span class="hljs-number">0.</span>0381s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">60277</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">139</span> S ttl=<span class="hljs-number">47</span> id=<span class="hljs-number">14523</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">4175236769</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
SENT (<span class="hljs-number">1.</span>0411s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">60278</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">139</span> S ttl=<span class="hljs-number">45</span> id=<span class="hljs-number">7372</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">4175171232</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>.

PORT    STATE    SERVICE
<span class="hljs-number">139</span>/tcp filtered netbios-ssn
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">2.06</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-p 139</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Nous voyons dans le dernier scan que <code>Nmap</code> a envoyé deux paquets TCP avec le drapeau SYN. Par la durée (<code>2.06s</code>) du scan, nous pouvons reconnaître que cela a pris beaucoup plus de temps que les précédents (<code>~0.05s</code>). Le cas est différent si le pare-feu rejette les paquets. Pour cela, nous regardons le port TCP <code>445</code>, qui est traité en conséquence par une telle règle du pare-feu.</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -p <span class="hljs-number">445</span> --packet-trace -n --disable-arp-ping -Pn

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">55</span> CEST
SENT (<span class="hljs-number">0.</span>0388s) TCP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">52472</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> S ttl=<span class="hljs-number">49</span> id=<span class="hljs-number">21763</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">1418633433</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
RCVD (<span class="hljs-number">0.</span>0487s) ICMP [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> Port <span class="hljs-number">445</span> unreachable (type=<span class="hljs-number">3</span>/code=<span class="hljs-number">3</span>) ] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">20998</span> iplen=<span class="hljs-number">72</span> ]
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span> (<span class="hljs-number">0.</span>0099s latency).

PORT    STATE    SERVICE
<span class="hljs-number">445</span>/tcp filtered microsoft-<span class="hljs-built_in">ds</span>
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.05</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-p 445</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
      </tbody>
    </table>
    <p>En réponse, nous recevons une réponse <code>ICMP</code> avec <code>type 3</code> et <code>code d'erreur 3</code>, ce qui indique que le port souhaité est inaccessible. Néanmoins, si nous savons que l'hôte est vivant, nous pouvons fortement supposer que le pare-feu sur ce port rejette les paquets, et nous devrons examiner ce port de plus près plus tard.</p>
    <hr>
    <h3 id="discovering-open-udp-ports">Découvrir les ports UDP ouverts</h3>
    <p>Certains administrateurs système oublient parfois de filtrer les ports UDP en plus des ports TCP. Comme <code>UDP</code> est un protocole <code>sans état</code> et ne nécessite pas de handshake à trois voies comme TCP. Nous ne recevons aucun accusé de réception. Par conséquent, le timeout est beaucoup plus long, ce qui rend l'ensemble du <code>scan UDP</code> (<code>-sU</code>) beaucoup plus lent que le <code>scan TCP</code> (<code>-sS</code>).</p>
    <p>Regardons un exemple de ce à quoi peut ressembler un scan UDP (<code>-sU</code>) et les résultats qu'il nous donne.</p>
    <p><strong>Scan de port UDP</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo <span class="hljs-keyword">nmap</span> <span class="hljs-number">10.129</span>.<span class="hljs-number">2.28</span> -F -sU

Starting Nmap <span class="hljs-number">7.80</span> ( http<span class="hljs-variable">s:</span>//<span class="hljs-keyword">nmap</span>.org ) at <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">01</span> CEST
Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span>.<span class="hljs-number">2.28</span>
Host <span class="hljs-keyword">is</span> <span class="hljs-keyword">up</span> (<span class="hljs-number">0.059</span>s latency).
Not shown: <span class="hljs-number">95</span> closed ports
PORT     STATE         SERVICE
<span class="hljs-number">68</span>/udp   <span class="hljs-keyword">open</span>|filtered dhcpc
<span class="hljs-number">137</span>/udp  <span class="hljs-keyword">open</span>          netbios-ns
<span class="hljs-number">138</span>/udp  <span class="hljs-keyword">open</span>|filtered netbios-dgm
<span class="hljs-number">631</span>/udp  <span class="hljs-keyword">open</span>|filtered ipp
<span class="hljs-number">5353</span>/udp <span class="hljs-keyword">open</span>          zeroconf
MAC Addres<span class="hljs-variable">s:</span> DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host <span class="hljs-keyword">up</span>) scanned in <span class="hljs-number">98.07</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-F</code></td>
          <td>Scanne les 100 ports les plus courants.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Un autre inconvénient est que nous n'obtenons souvent pas de réponse car <code>Nmap</code> envoie des datagrammes vides aux ports UDP scannés, et nous ne recevons aucune réponse. Nous ne pouvons donc pas déterminer si le paquet UDP est arrivé ou non. Si le port UDP est <code>ouvert</code>, nous n'obtenons une réponse que si l'application est configurée pour le faire.</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -sU -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">137</span> --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">15</span> CEST
SENT (<span class="hljs-number">0.</span>0367s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">55478</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">137</span> ttl=<span class="hljs-number">57</span> id=<span class="hljs-number">9122</span> iplen=<span class="hljs-number">78</span>
RCVD (<span class="hljs-number">0.</span>0398s) UDP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">137</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">55478</span> ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">13222</span> iplen=<span class="hljs-number">257</span>
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>0031s latency).

PORT    STATE SERVICE    REASON
<span class="hljs-number">137</span>/udp open  netbios-ns udp-response ttl <span class="hljs-number">64</span>
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">0.04</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <th><strong>Description</strong></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 137</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Si nous obtenons une réponse ICMP avec le <code>code d'erreur 3</code> (port inaccessible), nous savons que le port est effectivement <code>fermé</code>.</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -sU -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">100</span> --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">25</span> CEST
SENT (<span class="hljs-number">0.</span>0445s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">63825</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">100</span> ttl=<span class="hljs-number">57</span> id=<span class="hljs-number">29925</span> iplen=<span class="hljs-number">28</span>
RCVD (<span class="hljs-number">0.</span>1498s) ICMP [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span> Port unreachable (type=<span class="hljs-number">3</span>/code=<span class="hljs-number">3</span>) ] <span class="hljs-built_in">IP</span> [ttl=<span class="hljs-number">64</span> id=<span class="hljs-number">11903</span> iplen=<span class="hljs-number">56</span> ]
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>11s latency).

PORT    STATE  SERVICE REASON
<span class="hljs-number">100</span>/udp closed unknown port-unreach ttl <span class="hljs-number">64</span>
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span>  <span class="hljs-number">0.15</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <strong>Description</strong>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 100</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
      </tbody>
    </table>
    <hr>
    <p>Pour toutes les autres réponses ICMP, les ports scannés sont marqués comme (<code>ouvert|filtré</code>).</p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -sU -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">138</span> --reason 

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">15</span> <span class="hljs-number">16</span>:<span class="hljs-number">32</span> CEST
SENT (<span class="hljs-number">0.</span>0380s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">52341</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">138</span> ttl=<span class="hljs-number">50</span> id=<span class="hljs-number">65159</span> iplen=<span class="hljs-number">28</span>
SENT (<span class="hljs-number">1.</span>0392s) UDP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">52342</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">138</span> ttl=<span class="hljs-number">40</span> id=<span class="hljs-number">24444</span> iplen=<span class="hljs-number">28</span>
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set.

PORT    STATE         SERVICE     REASON
<span class="hljs-number">138</span>/udp open|filtered netbios-dgm no-response
MAC Address: DE:AD:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:BE:EF (Intel Corporate)

Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">2.06</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <strong>Description</strong>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-sU</code></td>
          <td>Effectue un scan UDP.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 138</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
      </tbody>
    </table>
    <p>Une autre méthode pratique pour scanner les ports est l'option <code>-sV</code> qui permet d'obtenir des informations supplémentaires disponibles sur les ports ouverts. Cette méthode peut identifier les versions, les noms de services et des détails sur notre cible.</p>
    <p><strong>Scan de version</strong></p>
    <p>Balayage d'hôtes et de ports</p>
    <pre><code class="lang-shell-session">root@htb[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span> -Pn -n --disable-arp-ping --packet-trace -p <span class="hljs-number">445</span> --reason  -sV

Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-meta">at</span> <span class="hljs-number">2022</span>-<span class="hljs-number">11</span>-<span class="hljs-number">04</span> <span class="hljs-number">11</span>:<span class="hljs-number">10</span> GMT
SENT (<span class="hljs-number">0.</span>3426s) TCP <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">44641</span> &gt; <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> S ttl=<span class="hljs-number">55</span> id=<span class="hljs-number">43401</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">3589068008</span> win=<span class="hljs-number">1024</span> &lt;mss <span class="hljs-number">1460</span>&gt;
RCVD (<span class="hljs-number">0.</span>3556s) TCP <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> &gt; <span class="hljs-number">10.10</span><span class="hljs-meta">.14</span><span class="hljs-meta">.2</span>:<span class="hljs-number">44641</span> SA ttl=<span class="hljs-number">63</span> id=<span class="hljs-number">0</span> iplen=<span class="hljs-number">44</span>  seq=<span class="hljs-number">2881527699</span> win=<span class="hljs-number">29200</span> &lt;mss <span class="hljs-number">1337</span>&gt;
NSOCK INFO [<span class="hljs-number">0.</span>4980s] nsock_iod_new2(): nsock_iod_new (IOD #<span class="hljs-number">1</span>)
NSOCK INFO [<span class="hljs-number">0.</span>4980s] nsock_connect_tcp(): TCP connection requested to <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> (IOD #<span class="hljs-number">1</span>) EID <span class="hljs-number">8</span>
NSOCK INFO [<span class="hljs-number">0.</span>5130s] nsock_trace_handler_callback(): Callback: CONNECT SUCCESS for EID <span class="hljs-number">8</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
Service scan sending probe NULL to <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> (tcp)
NSOCK INFO [<span class="hljs-number">0.</span>5130s] nsock_read(): Read request from IOD #<span class="hljs-number">1</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>] (timeout: 6000ms) EID <span class="hljs-number">18</span>
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_trace_handler_callback(): Callback: READ TIMEOUT for EID <span class="hljs-number">18</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
Service scan sending probe SMBProgNeg to <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> (tcp)
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_write(): Write request for <span class="hljs-number">168</span> bytes to IOD #<span class="hljs-number">1</span> EID <span class="hljs-number">27</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_read(): Read request from IOD #<span class="hljs-number">1</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>] (timeout: 5000ms) EID <span class="hljs-number">34</span>
NSOCK INFO [<span class="hljs-number">6.</span>5190s] nsock_trace_handler_callback(): Callback: WRITE SUCCESS for EID <span class="hljs-number">27</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>]
NSOCK INFO [<span class="hljs-number">6.</span>5320s] nsock_trace_handler_callback(): Callback: READ SUCCESS for EID <span class="hljs-number">34</span> [<span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span>] (<span class="hljs-number">135</span> bytes)
Service scan match (Probe SMBProgNeg matched with SMBProgNeg line <span class="hljs-number">13836</span>): <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>:<span class="hljs-number">445</span> is netbios-ssn.  Version: |Samba smbd|<span class="hljs-number">3.</span>X - <span class="hljs-number">4.</span>X|workgroup: WORKGROUP|
NSOCK INFO [<span class="hljs-number">6.</span>5320s] nsock_iod_delete(): nsock_iod_delete (IOD #<span class="hljs-number">1</span>)
Nmap scan report for <span class="hljs-number">10.129</span><span class="hljs-meta">.2</span><span class="hljs-meta">.28</span>
Host is <span class="hljs-meta">up</span>, received user-set (<span class="hljs-number">0.</span>013s latency).

PORT    STATE SERVICE     REASON         VERSION
<span class="hljs-number">445</span>/tcp open  netbios-ssn syn-ack ttl <span class="hljs-number">63</span> Samba smbd <span class="hljs-number">3.</span>X - <span class="hljs-number">4.</span>X (workgroup: WORKGROUP)
Service Info: Host: Ubuntu

Service detection performed. Please report any incorrect results <span class="hljs-meta">at</span> https://nmap.org/submit/ .
Nmap done: <span class="hljs-number">1</span> <span class="hljs-built_in">IP</span> address (<span class="hljs-number">1</span> host <span class="hljs-meta">up</span>) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">6.55</span> seconds
</code></pre>
    <table>
      <thead>
        <tr>
          <th><strong>Options de balayage</strong></th>
          <strong>Description</strong>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>10.129.2.28</code></td>
          <td>Scanne la cible spécifiée.</td>
        </tr>
        <tr>
          <td><code>-Pn</code></td>
          <td>Désactive les requêtes ICMP Echo.</td>
        </tr>
        <tr>
          <td><code>-n</code></td>
          <td>Désactive la résolution DNS.</td>
        </tr>
        <tr>
          <td><code>--disable-arp-ping</code></td>
          <td>Désactive le ping ARP.</td>
        </tr>
        <tr>
          <td><code>--packet-trace</code></td>
          <td>Affiche tous les paquets envoyés et reçus.</td>
        </tr>
        <tr>
          <td><code>-p 445</code></td>
          <td>Scanne uniquement le port spécifié.</td>
        </tr>
        <tr>
          <td><code>--reason</code></td>
          <td>Affiche la raison pour laquelle un port est dans un état particulier.</td>
        </tr>
        <tr>
          <td><code>-sV</code></td>
          <td>Effectue un scan de service.</td>
        </tr>
      </tbody>
    </table>
    <p>Plus d'informations sur les techniques de balayage de ports peuvent être trouvées à : <a href="https://nmap.org/book/man-port-scanning-techniques.html">https://nmap.org/book/man-port-scanning-techniques.html</a></p>
    <h2 id="saving-the-results">Sauvegarde des résultats</h2>
    <hr>
    <h3 id="different-formats">Différents formats</h3>
    <p>Pendant que nous exécutons divers scans, nous devrions toujours sauvegarder les résultats. Nous pouvons les utiliser plus tard pour examiner les différences entre les différentes méthodes de balayage que nous avons utilisées. <code>Nmap</code> peut sauvegarder les résultats dans 3 formats différents.</p>
    <ul>
      <li>Sortie normale (<code>-oN</code>) avec l'extension de fichier <code>.nmap</code></li>
      <li>Sortie "grepable" (<code>-oG</code>) avec l'extension de fichier <code>.gnmap</code></li>
      <li>Sortie XML (<code>-oX</code>) avec l'extension de fichier <code>.xml</code></li>
    </ul>
    <p>Nous pouvons également spécifier l'option (<code>-oA</code>) pour sauvegarder les résultats dans tous les formats. La commande pourrait ressembler à ceci :</p>
    <p>Sauvegarde des résultats</p>
    <pre><code class="lang-shell-session">root<span class="hljs-meta">@htb</span>[/htb]$ sudo nmap <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span> -p- -oA target

Starting Nmap <span class="hljs-number">7.80</span> ( <span class="hljs-string">https:</span><span class="hljs-comment">//nmap.org ) at 2020-06-16 12:14 CEST</span>
Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.129</span><span class="hljs-number">.2</span><span class="hljs-number">.28</span>
Host is up (<span class="hljs-number">0.0091</span>s latency).
Not <span class="hljs-string">shown:</span> <span class="hljs-number">65525</span> closed ports
PORT      STATE SERVICE
<span class="hljs-number">22</span>/tcp    open  ssh
<span class="hljs-number">25</span>/tcp    open  smtp
<span class="hljs-number">80</span>/tcp    open  http
MAC <span class="hljs-string">Address:</span> <span class="hljs-string">DE:</span><span class="hljs-string">AD:</span><span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-string">BE:</span>EF (Intel Corporate)

Nmap <span class="hljs-string">done:</span> <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">10.22</span> seconds
</code></pre>
    <table data-header-hidden>
      <thead>
        <tr>
          <th width="188"></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Options de balayage</strong></td>
          <td><strong>Description</strong></td>
        </tr>
        <
